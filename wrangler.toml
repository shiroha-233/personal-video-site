name = "personal-video-site"
compatibility_date = "2024-09-20"
compatibility_flags = ["nodejs_compat"]

[build]
command = "npm install --legacy-peer-deps && npm run build && npx @cloudflare/next-on-pages"
cwd = "."

[build.upload]
format = "modules"
directory = ".vercel/output/static"

[[build.upload.rules]]
type = "ESModule"
globs = ["**/*.js"]

[vars]
NODE_ENV = "production"
NEXT_PUBLIC_BASE_URL = "https://personal-video-site.pages.dev"

# 增加超时时间和内存限制
[limits]
cpu_ms = 50000
memory_mb = 128

# 路由配置
[[routes]]
pattern = "/api/*"
zone_name = ""
custom_domain = false